{% extends "base.html" %}
{% block content %}
  <h4>Results — No Eve vs With Eve</h4>

  <div class="row">
    <div class="col-md-6">
      <div class="card p-3 mb-3">
        <h5 class="text-success">No Eve (ideal)</h5>
        <p><b>Sifted key (Alice):</b> {{ alice_key_no_eve }}</p>
        <p><b>Sifted key (Bob):</b> {{ bob_key_no_eve }}</p>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card p-3 mb-3">
        <h5 class="text-danger">With Eve (intercept-resend)</h5>
        <p><b>Sifted key (Alice):</b> {{ alice_key_with_eve }}</p>
        <p><b>Sifted key (Bob):</b> {{ bob_key_with_eve }}</p>
        <p><b>QBER:</b> {{ qber }}%</p>
      </div>
    </div>
  </div>

  <h5>Per-qubit details</h5>
  <table class="table table-sm table-bordered text-light">
    <thead>
      <tr><th>#</th><th>Alice bit</th><th>Alice basis</th><th>Bob basis</th><th>Bob no Eve</th><th>Bob with Eve</th><th>Bases match?</th><th>Eve intercepted?</th></tr>
    </thead>
    <tbody>
      {% for r in rows %}
        <tr>
          <td>{{ r.index + 1 }}</td>
          <td>{{ r.alice_bit }}</td>
          <td>{{ r.alice_basis }}</td>
          <td>{{ r.bob_basis }}</td>
          <td>{{ r.bob_no_eve }}</td>
          <td>{{ r.bob_with_eve }}</td>
          <td>{% if r.bases_match %}✅{% else %}—{% endif %}</td>
          <td>{% if r.eve_info and r.eve_info.intercepted %}Yes ({{ r.eve_info.eve_basis }},{{ r.eve_info.eve_meas }}){% else %}No{% endif %}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-3">
    <a class="btn btn-primary" href="{{ url_for('message_send') }}">Use Key (No Eve) to Send Message →</a>
    <a class="btn btn-link" href="{{ url_for('alice') }}">Restart</a>
  </div>
{% endblock %}
